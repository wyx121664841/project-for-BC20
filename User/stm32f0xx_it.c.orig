/***************************************************************************//**
  * @file    stm32f0xx_it.c
  * @author  吴国炎
  * @version V1.0.0
  * @date    2012年8月16号
  * @brief   中断服务函数代码
*******************************************************************************/

/* 包含头文件 *****************************************************************/

#include "stm32f0xx.h"
#include "stm32f0xx_exti.h"
#include "delay.h"
#include "USART1.h"
#define  PM25L   GPIO_ReadInputDataBit(GPIOB,GPIO_Pin_0)
/* 私有类型定义---------------------------------------------------------------*/
/* 私有定义 ------------------------------------------------------------------*/
/* 私有宏定义 ----------------------------------------------------------------*/
/* 私有变量 ------------------------------------------------------------------*/
/* 私有函数声明 --------------------------------------------------------------*/
/* 私有函数 ------------------------------------------------------------------*/

/******************************************************************************/
/*                      STM32F0xx 外设 中断 服务函数                          */
/******************************************************************************/

// /***************************************************************************//**
//   * @brief  xx的中断处理函数
//   * @note   无
//   * @param  无
//   * @retval 无
// *******************************************************************************/
// void PPP_Handler(void)
// {
// }

/******************************************************************************/
/*                  Cortex-M0 处理器的相关中断服务函数                        */
/******************************************************************************/

/***************************************************************************//**
  * @brief  不可屏蔽中断发生的中断处理函数
  * @note   该中断是m3内核中不可屏蔽的中断
  * @param  无
  * @retval 无
*******************************************************************************/
void NMI_Handler(void)
{
}

/***************************************************************************//**
  * @brief  硬件错误发生的中断处理函数
  * @note   程序运行中硬件发生错误时就会进入该中断
  * @param  无
  * @retval 无
*******************************************************************************/
void HardFault_Handler(void)
{
    //当硬件错误发生时进入死循环
    while (1)
    {
    }
}

/***************************************************************************//**
  * @brief  SVC调用中断发生的中断处理函数
  * @note   无
  * @param  无
  * @retval 无
*******************************************************************************/
void SVC_Handler(void)
{
}

// /***************************************************************************//**
//   * @brief  Pend SV中断发生的中断处理函数
//   * @note   无
//   * @param  无
//   * @retval 无
// *******************************************************************************/
// void PendSV_Handler(void)
// {
// }

// /***************************************************************************//**
//   * @brief  SysTick中断发生的中断处理函数
//   * @note   无
//   * @param  无
//   * @retval 无
// *******************************************************************************/
// void SysTick_Handler(void)
// {
// }
extern float PM25content;
u8 countPM25=0;
u16 temp=0;
u8 PM25flag=0;
void EXTI0_1_IRQHandler(void)
{
		u16 c=0;
		
    if(EXTI_GetITStatus(EXTI_Line0) != RESET)
    {
      EXTI_ClearITPendingBit(EXTI_Line0);
			delay_ms(1);
			while(PM25L==RESET&&c<50000)
			{
				c++;
				delay_ms(1);
			}
			if(c>3)
			{
				countPM25++;
				temp+=c;
			}
			if(countPM25>4)
			{
				PM25content=temp/countPM25;
				countPM25=0;
				temp=0;
				if(PM25content>550)PM25flag=1;
			}
			
		}
		if(EXTI_GetITStatus(EXTI_Line1) != RESET)
    {
        EXTI_ClearITPendingBit(EXTI_Line1);
			
		}
}





